<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cherry Muse</title>
  <link rel="icon" type="image/x-icon" href="./icons/favicon.ico">
  <link rel="icon" type="image/png" sizes="32x32" href="./icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="./icons/favicon-16x16.png">
  <link rel="apple-touch-icon" sizes="180x180" href="./icons/apple-touch-icon.png">
  <link rel="stylesheet" href="./lib/cherry-markdown.min.css">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      height: 100vh;
      overflow: hidden;
      background: #fafafa;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
    }

    #editor-container {
      width: 100%;
      height: 100vh;
    }

    /* 滚动条样式 */
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }

    ::-webkit-scrollbar-track {
      background: transparent;
    }

    ::-webkit-scrollbar-thumb {
      background: #d0d0d0;
      border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: #b0b0b0;
    }
  </style>
</head>
<body>
  <div id="editor-container"></div>

  <script src="./lib/cherry-markdown.min.js"></script>
  <script>
    // Typora 风格配置
    const cherry = new Cherry({
      id: 'editor-container',
      value: '',
      toolbars: {
        toolbar: false, // 隐藏工具栏
      },
      editor: {
        defaultModel: 'edit&preview', // 默认分屏模式
      }
    });

    // 当前编辑模式
    let currentMode = 'edit&preview';
    const modes = ['edit&preview', 'editOnly', 'previewOnly'];
    let modeIndex = 0;

    // 菜单：打开文件
    window.electronAPI.onMenuOpen(async () => {
      const result = await window.electronAPI.openFile();
      if (result) {
        cherry.setMarkdown(result.content);
      }
    });

    // 菜单：保存
    window.electronAPI.onMenuSave(async () => {
      const content = cherry.getMarkdown();
      await window.electronAPI.saveFile(content);
    });

    // 菜单：另存为
    window.electronAPI.onMenuSaveAs(async () => {
      const content = cherry.getMarkdown();
      await window.electronAPI.saveFileAs(content);
    });

    // 菜单：切换模式
    window.electronAPI.onMenuToggleMode(() => {
      modeIndex = (modeIndex + 1) % modes.length;
      currentMode = modes[modeIndex];
      cherry.switchModel(currentMode);
    });

    // 快捷键：保存
    document.addEventListener('keydown', async (e) => {
      // Cmd/Ctrl + S
      if ((e.metaKey || e.ctrlKey) && e.key === 's' && !e.shiftKey) {
        e.preventDefault();
        const content = cherry.getMarkdown();
        await window.electronAPI.saveFile(content);
      }
      // Cmd/Ctrl + Shift + S
      else if ((e.metaKey || e.ctrlKey) && e.key === 's' && e.shiftKey) {
        e.preventDefault();
        const content = cherry.getMarkdown();
        await window.electronAPI.saveFileAs(content);
      }
      // Cmd/Ctrl + O
      else if ((e.metaKey || e.ctrlKey) && e.key === 'o') {
        e.preventDefault();
        const result = await window.electronAPI.openFile();
        if (result) {
          cherry.setMarkdown(result.content);
        }
      }
      // Cmd/Ctrl + /
      else if ((e.metaKey || e.ctrlKey) && e.key === '/') {
        e.preventDefault();
        modeIndex = (modeIndex + 1) % modes.length;
        currentMode = modes[modeIndex];
        cherry.switchModel(currentMode);
      }
    });
  </script>
</body>
</html>
